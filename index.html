<!-- 
To do
- Split HTML/CSS/JS
- Fix black cell on toggle
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Blocks a Day</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .container {
            text-align: center;
            width: min(80vh,80vw);
            position: absolute;
            top: 0;
        }

        h1 {
            font-size: 2em;
            margin: 10px;
        }

        a {
            text-decoration: none;
        }

        a:hover {
            text-decoration:underline;
        }

        #grid-container {
            height: min(80vh,80vw);
            width: min(80vh,80vw);
            margin: auto;
        }

        .grid-row {
            display: flex;
        }

        .grid-cell {
            flex: 1 0 calc(100% / var(--grid-size) - 5px);
            padding-bottom: calc(100% / var(--grid-size) - 5px);
            border: 1px solid #ccc;
            margin: 1px;
        }

        .grid-cell:hover {
            cursor: pointer;
        }

        .black {
            background-color: black !important;
        }

        #toggleButton, #gridSizeButton {
            margin: 5px 0;
            padding: 5px 20px;
            font-size: 16px;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>100 Blocks a Day</h1>
        <div id="grid-container"></div>
        <button id="toggleButton">Toggle Colours</button>
        <button id="gridSizeButton">Change Grid Size</button>
        <p id="text">Each block represents 10 minutes.<br/>There are 100 blocks in total, representing 1000 minutes, or 16 hours 40 minutes.<br/>The grid starts at 6AM and finishes as 10:40PM.</p>
        <p><a id="wbw" href="https://waitbutwhy.com/2016/10/100-blocks-day.html" target="_blank">Learn more</a></p>
        <p><a id="gh" href="https://github.com/jamesdeluk/100-blocks-a-day" target="_blank">View on GitHub <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/></svg></a></p>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const gridContainer = document.getElementById('grid-container');
            const toggleButton = document.getElementById('toggleButton');
            const gridSizeButton = document.getElementById('gridSizeButton');
            const colours1_10 = [[0,255,0],[0,225,45],[0,195,75],[0,165,105],[0,135,135],[0,105,165],[0,75,195],[0,45,225],[0,0,255],[45,0,225],[75,0,195],[105,0,165],[135,0,135],[165,0,105],[195,0,75],[225,0,45],[255,0,0]];
            const colours2_10 = [[160,255,56],[90,255,56],[56,255,92],[56,255,163],[56,255,233],[56,207,255],[56,137,255],[56,66,255],[116,56,255],[186,56,255],[255,56,254],[255,56,183],[255,56,113],[255,69,56],[255,139,56],[255,209,56],[230,255,56]];
            const colours1_12 = [[0,255,0],[0,239,22],[0,222,44],[0,204,66],[0,185,87],[0,165,108],[0,144,129],[0,122,150],[0,99,171],[0,75,192],[0,51,213],[0,26,234],[0,0,255],[24,0,236],[48,0,216],[71,0,196],[94,0,175],[117,0,153],[140,0,130],[163,0,106],[186,0,81],[209,0,55],[232,0,28],[255,0,0]];
            const colours2_12 = [[160,255,56],[135,255,56],[110,255,56],[90,255,56],[73,255,74],[56,255,92],[56,255,128],[56,255,163],[56,255,198],[56,255,233],[56,231,255],[56,207,255],[56,172,255],[56,137,255],[56,101,255],[56,66,255],[86,56,255],[116,56,255],[151,56,255],[186,56,255],[220,56,255],[255,56,254],[255,56,183],[255,56,113]];
            const rampColours1 = ['#FFFFFF','#CDCDCD','#9B9B9B','#696969','#373737','#050505'];
            let currentColoursIndex = 0;
            let coloursArray1 = [colours1_10, colours2_10, rampColours1];
            let coloursArray2 = [colours1_12, colours2_12, rampColours1];
            let coloursArray = coloursArray1;
            let colours = coloursArray[currentColoursIndex];
            let repeat = true;
            let gridSize = 10; // Initial grid size
            const blockSize = 6; // Number of cells per colour block
            
            const cellStates = {}; // Store the state of each cell

            function calculateElapsedMinutes() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const elapsedMinutes = gridSize === 10 ? (hours - 6) * 60 + minutes : (hours) * 60 + minutes;
                console.log(elapsedMinutes);
                return elapsedMinutes;
            }

            function getColourForCell(index) {
                if (colours.length != 6) {
                    const colourIndex = Math.floor(index / blockSize) % colours.length;
                    const [r,g,b] = colours[colourIndex];
                    return `rgb(${r},${g},${b})`;
                } else {
                    const colourIndex = index % blockSize;
                    return colours[colourIndex];
                }
            }

            function updateGrid() {
                gridContainer.style.setProperty('--grid-size', gridSize);
                const elapsedMinutes = calculateElapsedMinutes();
                const totalCells = gridSize * gridSize;
                const filledCells = Math.min(Math.floor(elapsedMinutes / 10), totalCells);

                gridContainer.innerHTML = ''; // Clear previous grid

                for (let i = 0; i < gridSize; i++) {
                    const row = document.createElement('div');
                    row.classList.add('grid-row');
                    for (let j = 0; j < gridSize; j++) {
                        const cell = document.createElement('div');
                        cell.classList.add('grid-cell');
                        const cellIndex = i * gridSize + j;
                        if (cellIndex < filledCells && !cellStates[cellIndex]) {
                            const colour = getColourForCell(cellIndex);
                            cell.style.backgroundColor = colour;
                        }
                        if (cellStates[cellIndex]) {
                            cell.classList.add('black');
                        }
                        cell.addEventListener('click', function() {
                            cell.classList.toggle('black');
                            cellStates[cellIndex] = !cellStates[cellIndex];
                        });
                        row.appendChild(cell);
                    }
                    gridContainer.appendChild(row);
                }
            }

            toggleButton.addEventListener('click', function() {
                currentColoursIndex = (currentColoursIndex + 1) % coloursArray.length;
                colours = coloursArray[currentColoursIndex];
                console.log(colours);
                updateGrid();
            });

            gridSizeButton.addEventListener('click', function() {
                gridSize = gridSize === 10 ? 12 : 10;
                coloursArray = gridSize === 10 ? coloursArray1 : coloursArray2;
                const text = document.getElementById('text');
                text.innerHTML = gridSize === 10 ? "Each block represents 10 minutes.<br/>There are 100 blocks in total, representing 1000 minutes, or 16 hours 40 minutes.<br/>The grid starts at 6AM and finishes as 10:40PM." : "Each block represents 10 minutes.<br/>There are 144 blocks in total, representing 1440 minutes, or 24 hours.<br/>The grid starts at midnight.";
                updateGrid();
            });

            setInterval(updateGrid, 60000);

            updateGrid();
        });
    </script>
</body>
</html>
